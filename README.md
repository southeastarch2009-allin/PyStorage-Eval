# PyStorage-Eval: ç”µåŒ–å­¦å‚¨èƒ½ç”µç«™æŠ€ç»è¯„ä»·å¼•æ“Ž

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/releases/release/python-390/)
[![Standard](https://img.shields.io/badge/Standard-DL%2FT%202919--2025-red)](https://github.com/)

**PyStorage-Eval** æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºŽç”µåŒ–å­¦å‚¨èƒ½ç”µç«™æŠ€æœ¯ç»æµŽè¯„ä»·çš„ Python å·¥å…·ã€‚å®ƒä¸¥æ ¼éµå¾ª **DL/T 2919-2025ã€Šç”µåŒ–å­¦å‚¨èƒ½ç”µç«™ç»æµŽè¯„ä»·å¯¼åˆ™ã€‹**ï¼Œé‡‡ç”¨å…¨ç”Ÿå‘½å‘¨æœŸçŽ°é‡‘æµæŠ˜çŽ°ï¼ˆDCFï¼‰æ–¹æ³•è¿›è¡Œé¡¹ç›®è¯„ä¼°ã€‚

> **æ ¸å¿ƒä»·å€¼**ï¼šä¸“ä¸šã€å‡†ç¡®ã€ç¬¦åˆè¡Œä¸šæ ‡å‡†

## ðŸŒŸ æ ¸å¿ƒåŠŸèƒ½

### 1. å¤šç§æ”¶ç›Šæ¨¡å¼æ”¯æŒ
- âœ… **å³°è°·å¥—åˆ©**ï¼šä¾æ® DL/T 2919-2025 å…¬å¼ 4.2.7-1
- âœ… **å®¹é‡ç§Ÿèµ**ï¼šä¾æ® DL/T 2919-2025 å…¬å¼ 4.2.8-1
- âœ… **è¾…åŠ©æœåŠ¡**ï¼šæ”¯æŒè°ƒå³°ã€è°ƒé¢‘ç­‰è¾…åŠ©æœåŠ¡æ”¶å…¥
- âœ… **æ··åˆæ¨¡å¼**ï¼šå¤šç§æ”¶å…¥æ¥æºç»„åˆ

### 2. ç”µæ± æ›´æ¢ç­–ç•¥
- âœ… è°ƒå³°é¡¹ç›®ï¼šç”µæ± å¯¿å‘½ 10 å¹´
- âœ… è°ƒé¢‘é¡¹ç›®ï¼šç”µæ± å¯¿å‘½ 4 å¹´
- âœ… æ”¯æŒ**è´¹ç”¨åŒ–**å’Œ**èµ„æœ¬åŒ–**ä¸¤ç§å¤„ç†æ–¹å¼

### 3. åˆ†ç¦»æŠ˜æ—§è®¡ç®— (DL/T 2919-2025 E.1.4)
- âœ… ç”µæ± èµ„äº§ï¼šæŒ‰ç”µæ± å¯¿å‘½æŠ˜æ—§ (è°ƒå³°10å¹´/è°ƒé¢‘4å¹´)
- âœ… éžç”µæ± èµ„äº§ï¼šæŒ‰15å¹´æŠ˜æ—§ (åœŸå»ºã€ç”µæ°”ç­‰)
- âœ… å¯é…ç½®ç”µæ± èµ„äº§å æ¯” (`battery_asset_ratio`)

### 3. å®Œæ•´çš„æˆæœ¬æ ¸ç®—
- âœ… **å……ç”µæˆæœ¬**å•ç‹¬æ ¸ç®—ï¼ˆåŒºåˆ«äºŽå…‰ä¼çš„æ ¸å¿ƒç‰¹ç‚¹ï¼‰
- âœ… è¿ç»´è´¹ï¼šæŒ‰åŠŸçŽ‡ï¼ˆ30å…ƒ/kWï¼‰æˆ–ç”µé‡ï¼ˆ0.05å…ƒ/kWhï¼‰ä¼°ç®—
- âœ… ç”µæ± æ›´æ¢è´¹ç”¨

### 4. è´¢åŠ¡æŠ¥è¡¨è¾“å‡º
- âœ… æ”¶å…¥å’Œç¨Žé‡‘è¡¨
- âœ… æ€»æˆæœ¬è´¹ç”¨ä¼°ç®—è¡¨
- âœ… åˆ©æ¶¦ä¸Žåˆ©æ¶¦åˆ†é…è¡¨
- âœ… è´¢åŠ¡æŒ‡æ ‡æ±‡æ€»è¡¨
- âœ… æ•æ„Ÿæ€§åˆ†æž

## ðŸ“¦ ä¾èµ–é¡¹

```txt
pandas>=2.0.0,<3.0.0
numpy>=1.24.0,<2.0.0
numpy-financial>=1.1.0,<2.0.0
```

## ðŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/southeastarch2009-allin/PyStorage-Eval.git
cd PyStorage-Eval

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### åŸºç¡€ä½¿ç”¨

```python
from storage_eval import StorageProject

# é…ç½®é¡¹ç›®å‚æ•°
params = {
    # åŸºç¡€å‚æ•°
    'power_mw': 100.0,           # è£…æœºåŠŸçŽ‡ (MW)
    'capacity_mwh': 200.0,        # é¢å®šå®¹é‡ (MWh)
    'efficiency': 0.85,           # ç³»ç»Ÿæ•ˆçŽ‡ 85%
    'static_invest': 30000.0,     # é™æ€æŠ•èµ„ (ä¸‡å…ƒ)
    'loan_rate': 0.048,
    'capital_ratio': 0.2,

    # æ”¶ç›Šæ¨¡å¼: å³°è°·å¥—åˆ©
    'revenue_mode': 'arbitrage',
    'cycles_per_year': 330,       # å¹´å¾ªçŽ¯æ¬¡æ•°
    'charge_price': 0.3,         # å……ç”µç”µä»· (å…ƒ/kWh)
    'discharge_price': 0.9,        # æ”¾ç”µç”µä»· (å…ƒ/kWh)

    # ç”µæ± æ›´æ¢ç­–ç•¥
    'battery_life': 10,            # ç”µæ± å¯¿å‘½ (å¹´)
    'replacement_cost': 21000.0,   # æ›´æ¢æˆæœ¬ (ä¸‡å…ƒ)
    'replacement_mode': 'expense',  # è´¹ç”¨åŒ–
}

# åˆ›å»ºé¡¹ç›®å¹¶è®¡ç®—
project = StorageProject(params)
project.calculate_cash_flow()
metrics = project.get_metrics()

# è¾“å‡ºç»“æžœ
print(f"IRR (ç¨Žå‰): {metrics['å…¨æŠ•èµ„IRR(ç¨Žå‰)']}%")
print(f"æŠ•èµ„å›žæ”¶æœŸ: {metrics['æŠ•èµ„å›žæ”¶æœŸ(å¹´)']} å¹´")

# å¯¼å‡ºè´¢åŠ¡æŠ¥è¡¨
project.export_revenue_tax_table('output_æ”¶å…¥å’Œç¨Žé‡‘è¡¨.csv')
project.export_total_cost_table('output_æ€»æˆæœ¬è´¹ç”¨è¡¨.csv')
project.export_profit_table('output_åˆ©æ¶¦è¡¨.csv')
project.export_financial_summary_table('output_è´¢åŠ¡æŒ‡æ ‡æ±‡æ€»è¡¨.csv')
```

## ðŸ“Š API å‚è€ƒ

### StorageProject å‚æ•°

#### é€šç”¨å‚æ•°

| å‚æ•°å | ç±»åž‹ | å¿…å¡« | è¯´æ˜Ž | é»˜è®¤å€¼ |
|--------|------|------|------|--------|
| `power_mw` | float | âœ… | è£…æœºåŠŸçŽ‡ (MW) | - |
| `capacity_mwh` | float | âœ… | é¢å®šå®¹é‡ (MWh) | - |
| `efficiency` | float | âŒ | ç³»ç»Ÿæ•ˆçŽ‡ (0-1) | 0.85 |
| `static_invest` | float | âœ… | é™æ€æŠ•èµ„ (ä¸‡å…ƒ) | - |
| `hours` | float | âŒ | å¹´åˆ©ç”¨å°æ—¶æ•° | 1000 |
| `loan_rate` | float | âŒ | è´·æ¬¾åˆ©çŽ‡ | 0.049 |
| `capital_ratio` | float | âŒ | èµ„æœ¬é‡‘æ¯”ä¾‹ | 0.2 |
| `battery_asset_ratio` | float | âŒ | ç”µæ± èµ„äº§å æ¯” (0-1) | 0.6 |

#### æ”¶ç›Šæ¨¡å¼å‚æ•°

**å³°è°·å¥—åˆ© (`revenue_mode='arbitrage'`)ï¼š**
| å‚æ•°å | è¯´æ˜Ž |
|--------|------|
| `cycles_per_year` | å¹´å¾ªçŽ¯æ¬¡æ•° |
| `charge_price` | å……ç”µç”µä»· (å…ƒ/kWh) |
| `discharge_price` | æ”¾ç”µç”µä»· (å…ƒ/kWh) |

**å®¹é‡ç§Ÿèµ (`revenue_mode='capacity'`)ï¼š**
| å‚æ•°å | è¯´æ˜Ž |
|--------|------|
| `lease_capacity` | ç§Ÿèµå®¹é‡ (MW) |
| `lease_price` | ç§Ÿèµä»·æ ¼ (å…ƒ/MW/å¹´) |

**è¾…åŠ©æœåŠ¡ (`revenue_mode='ancillary'`)ï¼š**
| å‚æ•°å | è¯´æ˜Ž |
|--------|------|
| `ancillary_type` | `'peaking'`(è°ƒå³°) æˆ– `'frequency'`(è°ƒé¢‘) |
| `ancillary_revenue` | å¹´è¾…åŠ©æœåŠ¡æ”¶å…¥ (ä¸‡å…ƒ) |

#### ç”µæ± æ›´æ¢å‚æ•°

| å‚æ•°å | è¯´æ˜Ž |
|--------|------|
| `battery_life` | ç”µæ± å¯¿å‘½ (å¹´)ï¼Œè°ƒé¢‘=4ï¼Œè°ƒå³°=10 |
| `replacement_cost` | ç”µæ± æ›´æ¢æˆæœ¬ (ä¸‡å…ƒ)ï¼Œé»˜è®¤ä¸ºé™æ€æŠ•èµ„çš„70% |
| `replacement_mode` | `'expense'`(è´¹ç”¨åŒ–) æˆ– `'capitalize'`(èµ„æœ¬åŒ–) |
| `battery_asset_ratio` | ç”µæ± èµ„äº§å æ¯”ï¼Œç”¨äºŽåˆ†ç¦»æŠ˜æ—§è®¡ç®— (é»˜è®¤0.6) |

### æŠ˜æ—§è®¡ç®—è¯´æ˜Ž (DL/T 2919-2025 E.1.4)

ä¾æ®ã€Šç”µåŒ–å­¦å‚¨èƒ½ç”µç«™ç»æµŽè¯„ä»·å¯¼åˆ™ã€‹é™„å½• E.1.4ï¼ŒæŠ˜æ—§è®¡ç®—åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

1. **ç”µæ± èµ„äº§**ï¼šæŒ‰ç”µæ± å¯¿å‘½æŠ˜æ—§ (è°ƒå³°é¡¹ç›®10å¹´ï¼Œè°ƒé¢‘é¡¹ç›®4å¹´)
2. **éžç”µæ± èµ„äº§**ï¼šæŒ‰15å¹´æŠ˜æ—§ (åŒ…æ‹¬é›†è£…ç®±ã€å‡åŽ‹ç«™ã€åœŸå»ºç­‰)

å¹´æŠ˜æ—§é¢ = ç”µæ± èµ„äº§æŠ˜æ—§ + éžç”µæ± èµ„äº§æŠ˜æ—§

ç¤ºä¾‹ï¼šå¯¹äºŽ100MW/200MWhé¡¹ç›® (é™æ€æŠ•èµ„3äº¿å…ƒï¼Œç”µæ± å æ¯”60%)ï¼š
- ç¬¬1-10å¹´ï¼šæŠ˜æ—§ = 18000Ã—0.95/10 + 12000Ã—0.95/15 â‰ˆ 2233ä¸‡å…ƒ/å¹´
- ç¬¬11-15å¹´ï¼šæŠ˜æ—§ = 0 + 12000Ã—0.95/15 â‰ˆ 687ä¸‡å…ƒ/å¹´ (ä»…éžç”µæ± èµ„äº§)
- ç¬¬16-20å¹´ï¼šæŠ˜æ—§ = 0 (æ‰€æœ‰èµ„äº§å·²æŠ˜æ—§å®Œæ¯•)

### ä¸»è¦æ–¹æ³•

| æ–¹æ³• | è¯´æ˜Ž |
|------|------|
| `calculate_cash_flow()` | è®¡ç®—è¿è¥æœŸçŽ°é‡‘æµè¡¨ |
| `get_metrics()` | èŽ·å–æ ¸å¿ƒæŒ‡æ ‡ (IRRã€å›žæ”¶æœŸç­‰) |
| `export_revenue_tax_table()` | å¯¼å‡ºæ”¶å…¥å’Œç¨Žé‡‘è¡¨ |
| `export_total_cost_table()` | å¯¼å‡ºæ€»æˆæœ¬è´¹ç”¨ä¼°ç®—è¡¨ |
| `export_profit_table()` | å¯¼å‡ºåˆ©æ¶¦ä¸Žåˆ©æ¶¦åˆ†é…è¡¨ |
| `export_financial_summary_table()` | å¯¼å‡ºè´¢åŠ¡æŒ‡æ ‡æ±‡æ€»è¡¨ |

## ðŸ“ˆ è®¡ç®—æ¡ˆä¾‹

### å…¸åž‹ç‹¬ç«‹å‚¨èƒ½ç”µç«™

**é¡¹ç›®å‚æ•°ï¼š**
- è£…æœºåŠŸçŽ‡ï¼š100 MW
- é¢å®šå®¹é‡ï¼š200 MWh (2å°æ—¶å‚¨èƒ½)
- ç³»ç»Ÿæ•ˆçŽ‡ï¼š85%
- é™æ€æŠ•èµ„ï¼š3äº¿å…ƒ (1.5å…ƒ/Wh)
- è¿è¥æœŸï¼š20å¹´

**æ”¶ç›Šæ¨¡å¼ï¼šå³°è°·å¥—åˆ©**
- å¹´å¾ªçŽ¯æ¬¡æ•°ï¼š330æ¬¡
- å……ç”µç”µä»·ï¼š0.3 å…ƒ/kWh
- æ”¾ç”µç”µä»·ï¼š0.9 å…ƒ/kWh
- ä»·å·®ï¼š0.6 å…ƒ/kWh

**è¯„ä»·ç»“æžœï¼š**
- æ€»æŠ•èµ„ï¼š30,876 ä¸‡å…ƒ
- IRR (ç¨Žå‰)ï¼š**98.78%**
- IRR (ç¨ŽåŽ)ï¼š**97.49%**
- æŠ•èµ„å›žæ”¶æœŸï¼š**1.01 å¹´**

## ðŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT å¼€æºè®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ðŸ¤ è´¡çŒ®

æ¬¢è¿Žæäº¤ Issue å’Œ Pull Requestï¼

## ðŸ“§ è”ç³»

- ä»“åº“åœ°å€ï¼šhttps://github.com/southeastarch2009-allin/PyStorage-Eval

## ðŸ™ è‡´è°¢

æœ¬é¡¹ç›®å‚è€ƒäº† [PyPV-Eval](https://github.com/southeastarch2009-allin/PyPV-Eval) çš„æž¶æž„è®¾è®¡ï¼Œç”¨äºŽå…‰ä¼é¡¹ç›®æŠ€ç»è¯„ä»·ã€‚
